function sizeImg(){var e=$(window).height()
$(".bg-image").css("min-height",e-137+"px")}function onTest(){var e={}
e.id=document.getElementById("idUser").value,e.QUIZ_ID="QUIZ_02",e.START_DATE="2017-01-01",e.END_DATE="2017-01-02",e.PROGRESS_ID="3",e.ANSWERS="s0q0a1,s0q1a1,s0q2a2,s1q0a0,s1q1a2,s1q2a2,s2q0a1,s2q1a3,s2q2a1,s3q0a1,s3q1a0,s3q2a0,s4q0a1,s4q1a0,s4q2a3,s5q0a1,s5q1a0,s5q2a0,s6q0a0,s6q1a0,s6q2a2",e.QUIZ_SCORE="s0r1m6,s1r1m6,s2r1m6,s3r6m6,s4r5m6,s5r1m6,s6r4m6",$.ajax({method:"POST",url:baseUrl+"/php/test.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(e),complete:onTestComplete})}function onCancelAll(){location.reload()}function onLogin(e){$(".login_failed").addClass("hidden_failed"),e.preventDefault()
var t=document.getElementById("username").value.trim(),a=document.getElementById("psw").value.trim(),n=window.btoa(t+":"+a)
$.ajax({type:"GET",url:baseUrl+"/php/login_ajax.php",headers:{Authorization:n},complete:onLoginComplete})}function onLogout(){$.ajax({type:"GET",url:baseUrl+"/php/logout_ajax.php",complete:onLogoutComplete})}function onUserEdit(){var e=document.getElementById("edit_user_form"),t={}
t.id=e.id.value,t.name=e.name.value,t.firstName=e.firstName.value,t.username=e.username.value.trim(),t.userAuthentication={},t.userAuthentication.isActive=e.authentication_is_active.checked,t.userAuthentication.attemptFail=e.authentication_attempt_fail.value,t.userAuthentication.forceChange=e.authentication_force_change.checked,$.ajax({method:"POST",url:baseUrl+"/php/user_edit_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(t),complete:onUserEditComplete})}function onUserEditPermission(){var e=document.getElementById("edit_user_permission_form"),t={}
t.id=e.prevoius_permission.value,t.userPermission
for(var a=0;a<e.permission_list.length;a++)e.permission_list[a].checked&&(t.userPermission=e.permission_list[a].value)
$.ajax({method:"POST",url:baseUrl+"/php/user_edit_permission_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(t),complete:onUserEditComplete})}function onUserEditAgency(){var e=document.getElementById("edit_user_agency_form"),t={}
t.id=e.id.value,t.departmentId
for(var a=0;a<e.user_agency.length;a++)e.user_agency[a].checked&&(t.departmentId=e.user_agency[a].value)
$.ajax({method:"POST",url:baseUrl+"/php/user_edit_agency_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(t),complete:onUserEditComplete})}function onUserAdd(){var e={},t=document.getElementById("add_user_form")
return validateInput(t.firstName)?(e.firstName=t.firstName.value,validateInput(t.name)?(e.name=t.name.value,validateInput(t.username,"name")?(e.username=t.username.value.trim(),validateInput(t.password)?(e.password=t.password.value.trim(),e.forceChange=t.force.checked,void $.ajax({method:"POST",url:baseUrl+"/php/user_add_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(e),complete:onUserAddComplete})):!1):!1):!1):!1}function onUsersCreate(){var e={}
$.ajax({method:"POST",url:baseUrl+"/php/create_users_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(e),complete:onUsersCreateAccountComplete})}function onUserAddAccount(){var e=document.getElementById("add_user_account_form"),t=e.email.value
$.ajax({method:"POST",url:baseUrl+"/php/user_add_account_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(t),complete:onUserAddAccountComplete})}function onUserRemove(){var e=document.getElementById("edit_user_form"),t={}
t.id=e.id.value,$.ajax({method:"POST",url:baseUrl+"/php/user_remove_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(t),complete:onUserRemoveComplete})}function onUserEditPassword(){var e=document.getElementById("edit_user_password_form")
if(e.psw.value==e.psw1.value&&""!=e.psw.value){var t=e.psw.value.trim(),a=window.btoa(t)
$.ajax({method:"POST",url:baseUrl+"/php/user_edit_password_ajax.php",headers:{Authorization:a},complete:onUserEditPasswordComplete})}}function onUserChangePassword(){var e=document.getElementById("change_user_password_form")
if(e.psw.value==e.psw1.value&&""!=e.psw.value){var t=e.psw.value.trim(),a=window.btoa(t),n={}
n.id=e.id.value,$.ajax({method:"POST",url:baseUrl+"/php/user_change_password_ajax.php",headers:{Authorization:a},data:JSON.stringify(n),complete:onUserEditPasswordComplete})}}function onUserEditProfile(){var e=document.getElementById("edit_user_profile_form"),t={}
t.firstName=e.firstName.value,t.name=e.name.value,t.username=e.username.value.trim(),$.ajax({method:"POST",url:baseUrl+"/php/user_edit_profile_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(t),complete:onUserEditComplete})}function onDepartmentAdd(){var e={},t=document.getElementById("add_department_form")
validateInput(t.name)&&(e.name=t.name.value),e.description=t.description.value,0!=t.parent.value?e.parent=parseInt(t.parent.value):e.parent=null,$.ajax({method:"POST",url:baseUrl+"/php/department_add_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(e),complete:onDepartmentAddComplete})}function onDepartmentEdit(){var e={},t=document.getElementById("edit_department_form")
return e.id=t.id.value,validateInput(t.name)?(e.name=t.name.value,e.description=t.description.value,e.isActive=!0,e.parent=parseInt(t.parent.value),void $.ajax({method:"POST",url:baseUrl+"/php/department_edit_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(e),complete:onDepartmentEditComplete})):!1}function onAddQuiz(){var e={},t=document.getElementById("add_quiz_form")
if(!validateInput(t.QUIZ_ID,"name"))return!1
if(e.quizId=t.QUIZ_ID.value,!validateInput(t.TIME_TO_COMPLETE,"number"))return!1
if(e.timeToComplete=t.TIME_TO_COMPLETE.value,!validateInput(t.QUIZ_DATA,"text"))return!1
if(e.quizData=t.QUIZ_DATA.value,!validateInput(t.ANSWER_JSON,"text"))return!1
e.answerJson=t.ANSWER_JSON.value,e.lockedOnCompletion=t.LOCKED_ON_COMPLETION.checked,e.isUserCanDisplayChart=t.IS_USER_CAN_DISPLAY_CHART.checked,e.isUserCanDisplayQa=t.IS_USER_CAN_DISPLAY_QA.checked,e.isEnabled=t.IS_ENABLED.checked,e.isUserSeeGoodAnswer=t.IS_USER_SEE_GOOD_ANSWER.checked,e.agencies=[]
for(var a=0;a<t.agency_quiz.length;a++)t.agency_quiz[a].checked===!0&&e.agencies.push(t.agency_quiz[a].value)
return 0==e.agencies.length?($("input:radio[name='agency_quiz']").focus(),!1):void $.ajax({method:"POST",url:baseUrl+"/php/quiz_add_ajax.php",processData:!1,dataType:"json",contentType:"application/json",data:JSON.stringify(e),complete:onQuizAddComplete})}function onUserResult(){var e=document.getElementById("quizResultsSelf"),t=e.idQuiz.value
$.ajax({url:"../../php/nova_api_get_report_self_data.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,data:t,dataType:"text",success:function(e){if("QUERY_ERROR"==e||"DB_OPEN_ERROR"==e||"DB_READ_ERROR"==e)return void alert("ERREUR: lecture de la base de données impossible...")
var t=JSON.parse(e),a=t[0],n=t[1],r=t[2]
CreateUserPDF(JSON.stringify(a),JSON.stringify(n),JSON.stringify(r))},error:function(e,t,a){alert("ERREUR: lecture de la base de données impossible...")}})}function validateInput(e,t){if("checkbox"==e.type||"hidden"==e.type)return!0
if(void 0===t)var t=e.name.toLowerCase()
if(-1!=t.search("text"))return""!=e.value?!0:!1
if(-1!=t.search("phone"))var a=/^(\+1)? ?\(?[0-9]{3}\)? ?-?[0-9]{3} ?-?[0-9]{2} ?-?[0-9]{2}$/
if(-1!=t.search("password"))var a=/^.{4,16}$/
if(-1!=t.search("name")||-1!=t.search("city")||-1!=t.search("province")||-1!=t.search("country")||-1!=t.search("company")||-1!=t.search("description"))var a=/^[a-zA-Z0-9ÀÁÂÃÄÅàáâãäåÒÓÔÕÖØòóôõöøÈÉÊËèéêëÇçÌÍÎÏìíîïÙÚÛÜùúûüÿÑñ_-\s]{2,256}$/
if(-1!=t.search("email"))var a=/^.{2,30}@.{2,30}\.[a-zA-Z]{2,6}$/
if(-1!=t.search("code"))var a=/^[a-zA-Z0-9\s\- ]{2,64}$/
if(-1!=t.search("expires")||-1!=t.search("date"))var a=/(^20(1[5-9]{1}|[2-9]{1}[0-9]{1})-(0[1-9]{1}|1[0-2]{1})-([0-2]{1}[0-9]{1}|3[0-1]{1})$|^[a-zA-Z]{3,10} ([0-2]{1}[0-9]{1}|3[0-1]{1}), 20(1[0-9]{1}|[2-9]{1}[0-9]{1}), [0-9]{1,2}:[0-9]{1,2} (pm|am)$)/
if(-1!=t.search("address"))var a=/^.{0,256}$/
if(-1!=t.search("file"))var a=/^[a-zA-Z0-9\\:\/]{0,256}.zip$/
if(-1!=t.search("number"))var a=/^[0-9]{0,256}$/
return e.value.match(a)?!0:(e.focus(),!1)}function GetAllUsersFromServer(){$.ajax({url:baseUrl+"/php/user_get_all_ajax.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,dataType:"text",success:function(e){return"FALSE"==e?void alert("ERREUR: base de données innaccessible..."):(tableData=JSON.parse(e),void LoadDataTable())},error:function(e,t,a){alert("ERROR !")}})}function GetAllUsersAgencyFromServer(){var e=document.getElementById("id")
$.ajax({url:baseUrl+"/php/user_get_agency_ajax.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,data:e.value,dataType:"text",success:function(e){if("FALSE"==e)return void alert("ERREUR: base de données innaccessible...")
var t=JSON.parse(e)
tableData=t.users,LoadDataTableAgency()},error:function(e,t,a){alert("ERROR !")}})}function LoadDataTable(){tableUsers=$("#usersTable").DataTable({aLengthMenu:[[10,25,50,-1],[10,25,50,"Tous"]],data:tableData,autoWidth:!1,columnDefs:[{width:100,targets:0}],fixedColumns:!0,select:{style:"single"},dom:"Bflrtip",buttons:[{text:"S&eacute;lectionner tout",className:"black",action:function(){table.rows().deselect(),table.rows({search:"applied"}).select()}},{text:"S&eacute;lectionner aucun",className:"black",action:function(){table.rows().deselect()}}],columns:[{name:"USER_ID",data:0,title:"ID",visible:!1},{name:"USER_NOM",data:1,title:"NOM DE FAMILLE",className:"dt-center",width:"100"},{name:"USER_PRENOM",data:2,title:"PRENOM",className:"dt-center",width:"100"},{name:"USERNAME",data:3,title:"NOM D'USAGER",visible:!1},{name:"AGENCY",data:4,title:"AGENCE",className:"dt-center",width:"100"},{name:"GROUP",data:5,title:"GROUPE",className:"dt-center",width:"100"},{name:"CORPO",data:6,title:"CORPO",visible:!1}],language:{sProcessing:"Traitement en cours...",sSearch:"",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ment",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"< Pr&eacute;c&eacute;dent",sNext:"Suivant >",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"},select:{rows:{_:"%d lignes s&eacute;lectionn&eacute;es",0:"Cliquez pour s&eacute;lectionner une ligne",1:"1 ligne s&eacute;lectionn&eacute;e"}}}}),$('input[type="search"]').attr("placeholder","Rechercher"),tableUsers.on("select",function(e,t,a,n){var r=tableUsers.rows({selected:!0}).data().toArray(),o=baseUrl+"/"+account+"/user/"+r[0][0]+"/edit"
window.location.assign(o)})}function LoadDataTableAgency(){tableUserAgency=$("#dataTableAgency").DataTable({aLengthMenu:[[10,25,50,-1],[10,25,50,"Tous"]],data:tableData,select:{style:"single"},dom:"Bflrtip",columns:[{name:"USER_ID",data:0,title:"ID",visible:!1},{name:"USER_NOM",data:2,title:"NOM DE FAMILLE",className:"dt-center"},{name:"USER_PRENOM",data:3,title:"PRENOM",className:"dt-center"},{name:"USERNAME",data:1,title:"NOM D'USAGER",className:"dt-center"},{name:"CREATED",data:4,title:"CREE",visible:!1},{name:"MODIFIED",data:5,title:"MODIFIE",visible:!1}],language:{sProcessing:"Traitement en cours...",sSearch:"",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ment",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"< Pr&eacute;c&eacute;dent",sNext:"Suivant >",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"},select:{rows:{_:"&nbsp; %d lignes s&eacute;lectionn&eacute;es",0:"&nbsp; Cliquez pour s&eacute;lectionner une ligne",1:"&nbsp; 1 ligne s&eacute;lectionn&eacute;e"}}}}),$('input[type="search"]').attr("placeholder","Rechercher"),tableUserAgency.on("select",function(e,t,a,n){var r=tableUserAgency.rows({selected:!0}).data().toArray(),o=baseUrl+"/"+account+"/user/"+r[0][0]+"/edit"
window.location.assign(o)})}var PDF_GEN_OPTION_ANSWERS_SHORT=0,PDF_GEN_OPTION_SHOW_GRAPH=1,PDF_GEN_OPTION_SHOW_ANSWERS=2,PDF_GEN_OPTION_SEPERATE_PDF=3,PDF_GEN_OPTION_USER_REPORT_COMPARE=4,PDF_GEN_OPTION_SHOW_ANSWERS_SCORES=5,PDF_GEN_OPTION_SHOW_BEST_ANSWERS=6,DB_QUIZ_RESULTS_ID=0,DB_QUIZ_RESULTS_QUIZ_ID=1,DB_QUIZ_RESULTS_USER_ID=2,DB_QUIZ_RESULTS_START_DATE=3,DB_QUIZ_RESULTS_END_DATE=4,DB_QUIZ_RESULTS_PROGRESS_ID=5,DB_QUIZ_RESULTS_ANSWERS=6,DB_QUIZ_RESULTS_QUIZ_SCORE=7,DB_QUIZ_RESULTS_PREVIOUS_ANSWERS=8,DB_QUIZ_RESULTS_PREVIOUS_SCORES=9,DB_QUIZ_RESULTS_QUIZ_NAME=10,DB_QUIZ_RESULTS_USER_NAME=11,DB_QUIZ_RESULTS_CORPORATE_ID=12,DB_QUIZ_RESULTS_CORPORATE_NAME=13,DB_QUIZ_RESULTS_GROUP_ID=14,DB_QUIZ_RESULTS_GROUP_NAME=15,DB_QUIZ_RESULTS_AGENCY_ID=16,DB_QUIZ_RESULTS_AGENCY_NAME=17,DB_QUIZ_RESULTS_PROGRESS_NAME=18,tableData,tableUsers,tableUserAgency
window.addEventListener("load",function(){var e=document.getElementById("usersTable")
e&&GetAllUsersFromServer()
var t=document.getElementById("dataTableAgency")
t&&GetAllUsersAgencyFromServer()
var a=document.getElementById("onLogin")
a&&a.addEventListener("click",onLogin)
var n=document.getElementById("onLogout")
n&&n.addEventListener("click",onLogout)
var r=document.getElementById("onUserEdit")
r&&r.addEventListener("click",onUserEdit)
var o=document.getElementById("onUserAdd")
o&&o.addEventListener("click",onUserAdd)
var s=document.getElementById("onUsersCreate")
s&&s.addEventListener("click",onUsersCreate)
var i=document.getElementById("onUserAddAccount")
i&&i.addEventListener("click",onUserAddAccount)
var c=document.getElementById("onUserRemove")
c&&c.addEventListener("click",onUserRemove)
var l=document.getElementById("onUserEditPassword")
l&&l.addEventListener("click",onUserEditPassword)
var d=document.getElementById("onUserEditProfile")
d&&d.addEventListener("click",onUserEditProfile)
var u=document.getElementById("onUserChangePassword")
u&&u.addEventListener("click",onUserChangePassword)
var p=document.getElementById("onUserEditPermission")
p&&p.addEventListener("click",onUserEditPermission)
var m=document.getElementById("onUserEditAgency")
m&&m.addEventListener("click",onUserEditAgency)
var _=document.getElementById("onDepartmentAdd")
_&&_.addEventListener("click",onDepartmentAdd)
var E=document.getElementById("onDepartmentEdit")
E&&E.addEventListener("click",onDepartmentEdit)
var v=document.getElementById("onAddQuiz")
v&&v.addEventListener("click",onAddQuiz)
var g=document.getElementById("onUserResult")
g&&g.addEventListener("click",onUserResult)
var f=document.getElementById("cancelAll")
f&&f.addEventListener("click",onCancelAll)
var h=document.getElementById("test")
h&&h.addEventListener("click",onTest),$("input.editInput").keyup(function(){$(this).addClass("changed")}),$(".cancelAll").click(function(){location.reload()}),$(window).resize(function(){sizeImg()}),sizeImg()})
var error404="error 404",error409="error 409",unknownError="Ouch",onTestComplete=function(e){console.log(e.responseText)},onLoginComplete=function(e){if("true"===e.responseText){var t=window.location.pathname.split("/")
if("login"==t[t.length-1]||"connexion"==t[t.length-1]||"logout"==t[t.length-1]){var a=baseUrl+"/profile"
window.location.assign(a)}else location.reload()}else if("forceChange"===e.responseText){var t=window.location.pathname.split("/")
if("login"==t[t.length-1]||"connexion"==t[t.length-1]||"logout"==t[t.length-1]){var a=baseUrl+"/change"
window.location.assign(a)}else location.reload()}else $(".login_failed").removeClass("hidden_failed")},onLogoutComplete=function(e){if("true"===e.responseText){var t=baseUrl+"/login"
window.location.assign(t)}},onUserEditComplete=function(e){"true"===e.responseText?location.reload():location.reload()},onUserAddComplete=function(e){if("user_exists"===e.responseText)location.reload()
else if("false"!==e.responseText){var t=baseUrl+"/"+account+"/user/"+e.responseText+"/edit"
window.location.assign(t)}},onUserAddAccountComplete=function(e){if("true"===e.responseText){var t=baseUrl+"/"+account+"/user/list"
window.location.assign(t)}},onUsersCreateAccountComplete=function(e){if("true"===e.responseText){var t=baseUrl+"/"+account+"/user/list"
window.location.assign(t)}},onUserRemoveComplete=function(e){if("true"===e.responseText){var t=baseUrl+"/"+account+"/user/list"
window.location.assign(t)}else"404"===e.responseText&&(document.getElementById("errorMsg").innerHTML=error404),"409"===e.responseText?document.getElementById("errorMsg").innerHTML=error409:document.getElementById("errorMsg").innerHTML=unknownError,$("#msgModal").modal("show")},onUserEditPasswordComplete=function(e){if("true"===e.responseText){var t=baseUrl+"/profile"
window.location.assign(t)}},onDepartmentAddComplete=function(e){"true"===e.responseText&&location.reload()},onDepartmentEditComplete=function(e){"true"===e.responseText&&location.reload()},onQuizAddComplete=function(e){"true"===e.responseText&&location.reload()}
