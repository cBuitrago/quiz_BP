function GenerateParticipationReport(){var e=table.rows({selected:!0}).count()
if(0==e)return void alert("Vous devez sélectionner au minimum une donnée dans le tableau...")
var t=table.rows(".selected").data()
CreateReportPDF(t)}function GenerateUsersReports(){var e=table.rows({selected:!0}).count()
if(0==e)return void alert("Vous devez sélectionner au minimum une donnée dans le tableau...")
for(var t=table.rows(".selected").data(),a=0,_=0;e>_;_++)3!=table.rows(".selected").data()[_][DB_QUIZ_RESULTS_PROGRESS_ID]&&a++
if(a>0){var n
if(n=1==a?"1 quiz n'a pas été complété, celui-ci sera ignoré... Voulez-vous poursuivre ?":a+" quiz n'ont pas étés complétés, ceux-ci seront ignorés... Voulez-vous poursuivre ?",!confirm(n))return}var r=[]
for(_=0;e>_;_++)3==table.rows(".selected").data()[_][DB_QUIZ_RESULTS_PROGRESS_ID]&&r.push(t[_])
var o=[]
o[PDF_GEN_OPTION_SHOW_GRAPH]=document.getElementById("show_graph").checked?1:0,o[PDF_GEN_OPTION_SHOW_ANSWERS]=document.getElementById("show_answers").checked?1:0
var i=document.getElementById("user_report_compare")
return o[PDF_GEN_OPTION_USER_REPORT_COMPARE]=i.options[i.selectedIndex].value,o[PDF_GEN_OPTION_SHOW_ANSWERS_SCORES]=document.getElementById("show_answers_score").checked?1:0,o[PDF_GEN_OPTION_SHOW_BEST_ANSWERS]=document.getElementById("show_best_answers").checked?1:0,0==o[PDF_GEN_OPTION_SHOW_GRAPH]&&0==o[PDF_GEN_OPTION_SHOW_ANSWERS]?void alert("Les options de ne pas afficher le graphique de résultats et de ne pas afficher les questions/réponses ne peuvent pas être sélestionnées en même temps..."):(CreatePDF_Param_json_data=JSON.stringify(r),CreatePDF_Param_options_data=JSON.stringify(o),CreatePDF_Param_quiz_data=JSON.stringify(quiz_table),void CreatePDF(CreatePDF_Param_json_data,CreatePDF_Param_options_data,CreatePDF_Param_quiz_data))}function ApplyFilters(){var e=document.getElementById("filter_quiz_id"),t=document.getElementById("filter_corporate_id"),a=document.getElementById("filter_group_id"),_=document.getElementById("filter_agency_id"),n=document.getElementById("filter_quiz_progress")
"all"==e.options[e.selectedIndex].value?table.column(table.column("QUIZ_ID:name").index()).search("").draw():table.column(table.column("QUIZ_ID:name").index()).search("^\\b"+e.options[e.selectedIndex].value+"\\b$",!0,!1).draw(),"all"==t.options[t.selectedIndex].value?table.column(table.column("CORPORATE_ID:name").index()).search("").draw():table.column(table.column("CORPORATE_ID:name").index()).search("^\\b"+t.options[t.selectedIndex].value+"\\b$",!0,!1).draw(),"all"==a.options[a.selectedIndex].value?table.column(table.column("GROUP_ID:name").index()).search("").draw():table.column(table.column("GROUP_ID:name").index()).search("^\\b"+a.options[a.selectedIndex].value+"\\b$",!0,!1).draw(),"all"==_.options[_.selectedIndex].value?table.column(table.column("AGENCY_ID:name").index()).search("").draw():table.column(table.column("AGENCY_ID:name").index()).search("^\\b"+_.options[_.selectedIndex].value+"\\b$",!0,!1).draw(),"all"==n.options[n.selectedIndex].value?table.column(table.column("PROGRESS_ID:name").index()).search("").draw():table.column(table.column("PROGRESS_ID:name").index()).search("^\\b"+n.options[n.selectedIndex].value+"\\b$",!0,!1).draw()}function GetAllQuizInfoFromServer(){$.ajax({url:"../php/nova_api_get_report_data.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,dataType:"text",success:function(e){return"QUERY_ERROR"==e||"DB_OPEN_ERROR"==e||"DB_READ_ERROR"==e?void Alert("ERREUR: lecture de la base de données impossible..."):(return_data_array=JSON.parse(e),update_data=return_data_array[0],quiz_table=return_data_array[1],progress_table=return_data_array[2],void LoadDataTable())},error:function(e,t,a){alert("ERREUR: lecture de la base de données impossible...")}})}function GetQuizStructureFromServer(){$.ajax({url:"nova_api_manager_get.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,data:{data:"quiz"},dataType:"text",success:function(e){return"QUERY_ERROR"==e||"DB_OPEN_ERROR"==e?void Alert("ERREUR: lecture de la base de données impossible..."):(quiz_table=JSON.parse(e),void LoadDataTable())},error:function(e,t,a){alert("ERREUR: lecture de la base de données impossible...")}})}function GetQuizResultsFromServer(){$.ajax({url:"nova_api_manager_get.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,data:{data:"results"},dataType:"text",success:function(e){return"QUERY_ERROR"==e||"DB_OPEN_ERROR"==e?void Alert("ERREUR: lecture de la base de données impossible..."):(update_data=JSON.parse(e),void GetQuizStructureFromServer())},error:function(e,t,a){alert("ERREUR: lecture de la base de données impossible...")}})}function compareSecondColumn(e,t){return e[1]===t[1]?0:e[1]<t[1]?-1:1}function LoadDataTable(){table=$("#example").removeAttr("width").DataTable({aLengthMenu:[[10,25,50,-1],[10,25,50,"Tous"]],data:update_data,autoWidth:!1,columnDefs:[{width:100,targets:0}],fixedColumns:!0,select:{style:"multi"},dom:"Bflrtip",buttons:[{text:"S&eacute;lectionner tout",className:"black tout",action:function(){table.rows().deselect(),table.rows({search:"applied"}).select()}},{text:"S&eacute;lectionner aucun",className:"black aucun",action:function(){table.rows().deselect()}}],columns:[{name:"ID",data:DB_QUIZ_RESULTS_ID,title:"ID unique",visible:!1},{name:"USER_ID",data:DB_QUIZ_RESULTS_USER_ID,title:"ID Usager",visible:!1},{name:"USER_NAME",data:DB_QUIZ_RESULTS_USER_NAME,title:"Usager",className:"dt-center",width:"100"},{name:"CORPORATE_ID",data:DB_QUIZ_RESULTS_CORPORATE_ID,title:"ID Compagnie",visible:!1},{name:"CORPORATE_NAME",data:DB_QUIZ_RESULTS_CORPORATE_NAME,title:"Compagnie",visible:!1},{name:"GROUP_ID",data:DB_QUIZ_RESULTS_GROUP_ID,title:"ID Groupe",visible:!1},{name:"GROUP_NAME",data:DB_QUIZ_RESULTS_GROUP_NAME,title:"Groupe",className:"dt-center",width:"100"},{name:"AGENCY_ID",data:DB_QUIZ_RESULTS_AGENCY_ID,title:"ID Agence",visible:!1},{name:"AGENCY_NAME",data:DB_QUIZ_RESULTS_AGENCY_NAME,title:"Agence",className:"dt-center",width:"100"},{name:"QUIZ_ID",data:DB_QUIZ_RESULTS_QUIZ_ID,title:"ID Quiz",visible:!1},{name:"QUIZ_NAME",data:DB_QUIZ_RESULTS_QUIZ_NAME,title:"Quiz",className:"dt-center",width:"100"},{name:"START_DATE",data:DB_QUIZ_RESULTS_START_DATE,title:"Date d&eacute;but",className:"dt-center",width:"100"},{name:"END_DATE",data:DB_QUIZ_RESULTS_END_DATE,title:"Date fin",className:"dt-center",width:"100"},{name:"PROGRESS_ID",data:DB_QUIZ_RESULTS_PROGRESS_ID,title:"ID Progr&egrave;s",visible:!1},{name:"PROGRESS_NAME",data:DB_QUIZ_RESULTS_PROGRESS_NAME,title:"Progr&egrave;s",className:"dt-center",width:"100"},{name:"ANSWERS",data:DB_QUIZ_RESULTS_ANSWERS,title:"R&eacute;ponses",visible:!1},{name:"QUIZ_SCORE",data:DB_QUIZ_RESULTS_QUIZ_SCORE,title:"Pointage Quiz",visible:!1},{name:"PREVIOUS_ANSWERS",data:DB_QUIZ_RESULTS_PREVIOUS_ANSWERS,title:"Anciennes R&eacute;ponses",visible:!1},{name:"PREVIOUS_SCORES",data:DB_QUIZ_RESULTS_PREVIOUS_SCORES,title:"Pointage Quiz",visible:!1}],language:{sProcessing:"Traitement en cours...",sSearch:"",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ment",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"},select:{rows:{_:"%d lignes s&eacute;lectionn&eacute;es",0:"Cliquez pour s&eacute;lectionner une ligne",1:"1 ligne s&eacute;lectionn&eacute;e"}}}}),$('input[type="search"]').attr("placeholder","Rechercher")
for(var e=update_data.unique_quiz_id(),t=update_data.unique_corporate_id(),a=update_data.unique_group_id(),_=update_data.unique_agency_id(),n=0;n<e.length;n++){var r=document.getElementById("filter_quiz_id"),o=document.createElement("option")
o.text=e[n][1],o.value=e[n][0],r.add(o)}for(var i=0;i<t.length;i++){var l=document.getElementById("filter_corporate_id"),o=document.createElement("option")
o.text=t[i][1],o.value=t[i][0],l.add(o)}for(var s=0;s<a.length;s++){var c=document.getElementById("filter_group_id"),o=document.createElement("option")
o.text=a[s][1],o.value=a[s][0],c.add(o)}for(var d=0;d<_.length;d++){var u=document.getElementById("filter_agency_id"),o=document.createElement("option")
o.text=_[d][1],o.value=_[d][0],u.add(o)}for(var E=0;E<progress_table.length;E++){var S=document.getElementById("filter_quiz_progress"),o=document.createElement("option")
o.text=progress_table[E][1],o.value=progress_table[E][0],S.add(o)}$("#filter_quiz_id").val("all"),$("#filter_corporate_id").val("all"),$("#filter_group_id").val("all"),$("#filter_agency_id").val("all"),$("#filter_quiz_progress").val("all"),$("div.load").addClass("hidden-load"),$("select.select-filter").change(function(){ApplyFilters()})}var PDF_GEN_OPTION_ANSWERS_SHORT=0,PDF_GEN_OPTION_SHOW_GRAPH=1,PDF_GEN_OPTION_SHOW_ANSWERS=2,PDF_GEN_OPTION_SEPERATE_PDF=3,PDF_GEN_OPTION_USER_REPORT_COMPARE=4,PDF_GEN_OPTION_SHOW_ANSWERS_SCORES=5,PDF_GEN_OPTION_SHOW_BEST_ANSWERS=6,DB_QUIZ_RESULTS_ID=0,DB_QUIZ_RESULTS_QUIZ_ID=1,DB_QUIZ_RESULTS_USER_ID=2,DB_QUIZ_RESULTS_START_DATE=3,DB_QUIZ_RESULTS_END_DATE=4,DB_QUIZ_RESULTS_PROGRESS_ID=5,DB_QUIZ_RESULTS_ANSWERS=6,DB_QUIZ_RESULTS_QUIZ_SCORE=7,DB_QUIZ_RESULTS_PREVIOUS_ANSWERS=8,DB_QUIZ_RESULTS_PREVIOUS_SCORES=9,DB_QUIZ_RESULTS_QUIZ_NAME=10,DB_QUIZ_RESULTS_USER_NAME=11,DB_QUIZ_RESULTS_CORPORATE_ID=12,DB_QUIZ_RESULTS_CORPORATE_NAME=13,DB_QUIZ_RESULTS_GROUP_ID=14,DB_QUIZ_RESULTS_GROUP_NAME=15,DB_QUIZ_RESULTS_AGENCY_ID=16,DB_QUIZ_RESULTS_AGENCY_NAME=17,DB_QUIZ_RESULTS_PROGRESS_NAME=18,table,update_data,quiz_table,progress_table,CreatePDF_Param_json_data,CreatePDF_Param_options_data,CreatePDF_Param_quiz_data,chartjs_config,offscreenCanvas,currentChart
$body=$("body"),$(document).on({ajaxStart:function(){$body.addClass("loading")},ajaxStop:function(){$body.removeClass("loading")}}),$("#submitBtn").click(function(){alert($("#form").serialize()),$.ajax({url:"nova_api_add.php",type:"post",async:!0,headers:{"cache-control":"no-cache"},cache:!1,data:{data:JSON.stringify($("#form").serializeArray())},dataType:"text",success:function(e){return"QUERY_ERROR"==e||"DB_OPEN_ERROR"==e?void alert("ERREUR: base de données innaccessible..."):"ID_ALREADY_EXISTS"==e?(alert("Le ID Démo existe déjà dans la base de données, merci de choisir un nouveau nom..."),void document.getElementsByName("id_demo").focus()):void 0},error:function(e,t,a){alert("ERROR !")}})}),Array.prototype.contains=function(e){for(var t=0;t<this.length;t++)if(this[t][1]===e)return!0
return!1},Array.prototype.unique_quiz_id=function(){for(var e=[],t=0;t<this.length;t++)if(!e.contains(this[t][DB_QUIZ_RESULTS_QUIZ_NAME])){var a=[]
a[0]=this[t][DB_QUIZ_RESULTS_QUIZ_ID],a[1]=this[t][DB_QUIZ_RESULTS_QUIZ_NAME],e.push(a)}return e.sort(compareSecondColumn)},Array.prototype.unique_group_id=function(){for(var e=[],t=0;t<this.length;t++)if(!e.contains(this[t][DB_QUIZ_RESULTS_GROUP_NAME])){var a=[]
a[0]=this[t][DB_QUIZ_RESULTS_GROUP_ID],a[1]=this[t][DB_QUIZ_RESULTS_GROUP_NAME],e.push(a)}return e.sort(compareSecondColumn)},Array.prototype.unique_corporate_id=function(){for(var e=[],t=0;t<this.length;t++)if(!e.contains(this[t][DB_QUIZ_RESULTS_CORPORATE_NAME])){var a=[]
a[0]=this[t][DB_QUIZ_RESULTS_CORPORATE_ID],a[1]=this[t][DB_QUIZ_RESULTS_CORPORATE_NAME],e.push(a)}return e.sort(compareSecondColumn)},Array.prototype.unique_agency_id=function(){for(var e=[],t=0;t<this.length;t++)if(!e.contains(this[t][DB_QUIZ_RESULTS_AGENCY_NAME])){var a=[]
a[0]=this[t][DB_QUIZ_RESULTS_AGENCY_ID],a[1]=this[t][DB_QUIZ_RESULTS_AGENCY_NAME],e.push(a)}return e.sort(compareSecondColumn)},$(document).ready(function(){GetAllQuizInfoFromServer()})
